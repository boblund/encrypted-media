<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>ISO Common Encryption EME MPEG-2 Transport Stream Format</title>
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common" class="remove"></script>
    <script src="encrypted-media.js" class="remove"></script>
    <script class="remove">
      var respecConfig = {
      // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
      specStatus: "ED",

      // the specification's short name, as in http://www.w3.org/TR/short-name/
      shortName: "encrypted-media", <!-- The registry does not have its own short name. -->

      // if there a publicly available Editor's Draft, this is the link
      edDraftURI:           "https://w3c.github.io/encrypted-media/cenc-format.html",

      // if this is a LCWD, uncomment and set the end of its review period
      // lcEnd: "2009-08-05",

      // editors, add as many as you like
      // only "name" is required
      editors:  [
      { name: "David Dorwin",  url: "",
      company: "Google Inc.", companyURL: "https://www.google.com/" },
      { name: "Adrian Bateman", url: "",
      company: "Microsoft Corporation", companyURL: "https://www.microsoft.com/" },
      { name: "Mark Watson", url: "",
      company: "Netflix Inc.", companyURL: "https://www.netflix.com/" },
      { name: "Jerry Smith", url: "",
      company: "Microsoft Corporation", companyURL: "https://www.microsoft.com/" },
      ],

      otherLinks: [
        { key: "Repository",
        href: "https://github.com/w3c/encrypted-media/"}
      ],

      emeDefGroupName: "cenc-format",
      emeUnusedGroupNameExcludeList: ["encrypted-media",
                                      "eme-references-from-registry"
      ],

      // name of the WG
      wg:           "HTML Working Group",

      // URI of the public WG page
      wgURI:        "http://www.w3.org/html/wg/",

      // name (without the @w3c.org) of the public mailing to which comments are due
      wgPublicList: "public-html-media",

      // URI of the patent status for this WG, for Rec-track documents
      // !!!! IMPORTANT !!!!
      // This is important for Rec-track documents, do not copy a patent URI from a random
      // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
      // Team Contact.
      wgPatentURI: "https://www.w3.org/2004/01/pp-impl/40318/status",

      noIDLIn: true,

      scheme: "https",

      // Empty definitions for objects declared in the document are here to
      // prevent error messages from being displayed for references to these objects.
      definitionMap: {},

      preProcess: [ encryptedMediaPreProcessor ],

      // Empty definitions for objects declared in the document are here to
      // prevent error messages from being displayed for references to these objects.
      definitionMap: {},

      postProcess: [ encryptedMediaPostProcessor ],

      localBiblio: {
          "BMFF": {
            title: "ISO/IEC 14496-12:2012, Information technology -- Coding of audio-visual objects -- Part 12: ISO base media file format",
            href: "http://standards.iso.org/ittf/PubliclyAvailableStandards/c061988_ISO_IEC_14496-12_2012.zip",
            status: "International Standard",
            publisher: "ISO/IEC"
          },
          "CENC-1ST": {
            title: "ISO/IEC 23001-7:2012, Information technology -- MPEG systems technologies -- Part 7: Common encryption in ISO base media file format files",
            href: "https://www.iso.org/obp/ui/#iso:std:iso-iec:23001:-7:ed-1:v1",
            status: "International Standard",
            publisher: "ISO/IEC",
          },
          "CENC-2ND": {
            title: "ISO/IEC DIS 23001-7 2nd Edition",
            <!-- href: "https://www.iso.org/obp/ui/#iso:std:iso-iec:23001:-7:ed-2", -->
            status: "Draft International Standard",
            publisher: "ISO/IEC",
          },
          "CENC-MPEG2": {
            title: "Information technology — MPEG systems technologies — Part 9: Common Encryption of MPEG-2 Transport Streams",
            <!-- href: "http://www.iso.org/iso/home/store/catalogue_tc/catalogue_detail.htm?csnumber=63440", -->
            status: "International Standard",
            publisher: "ISO/IEC",
          },
          "CENC-INIT": {
            title: "ISO Common Encryption EME Initialization Data",
            <!-- href: "", -->
            status: "Editor's Draft",
            publisher: "W3C",
          }
        }
      };
    </script>
    <!-- script to register bugs -->
    <script src="https://w3c.github.io/webcomponents/assets/scripts/bug-assist.js"></script>
    <meta name="bug.product" content="HTML WG">
    <meta name="bug.component" content="Encrypted Media Extensions">

    <link rel="stylesheet" href="eme.css">
  </head>
  <body>
    <!-- TODO: Use styles for ISO boxes like the MSE registry. -->
    <section id="abstract">
      <p>This specification defines the stream format for Common Encryption of MPEG-2 Transport Streams 'CETS' [[!CENC-MPEG2]] with the <a def-id="eme-spec"></a>.
      Initialization data for cenc with Encrypted Media Extensions is defined in [[!CENC-INIT]].
      </p>
    </section>

    <section id="sotd">
      <p>The Working Group maintains <a href="https://www.w3.org/brief/MjY5"> a list of all bug reports that the editors have not yet tried to address</a>.</p>
      <p>Implementors should be aware that this specification is not stable. <strong>Implementors who are not taking part in the discussions are likely to find the specification changing out from under them in incompatible ways.</strong> Vendors interested in implementing this specification before it eventually reaches the Candidate Recommendation stage should join the mailing list mentioned below and take part in the discussions.</p>
    </section>

    <section id="stream-format">
      <h2>Stream Format</h2>
      <p>Under 'CETS', ISO Base media File Format [[!BMFF]] content encrypted at the sample level with AES-128 CTR encryption can be re-encapsulated in an MPEG-2 Transport Stream without re-encryption.</p>
      <p>Multiple Key Systems can be used to decrypt the same media content. Each key is identified by a <a def-id="key-id"></a> and each encrypted sample is associated with the Key ID of the key needed to decrypt it. This association is signaled either through the specification of the 'default_key_id' field or by the per access unit 'key_id' in the CETS Entitlement Control Message 'CETS ECM' carried in the 'cets_ecm()' descriptor. The 'cetc_ecm()' also carries per access unit Initialization Vector 'iv' data in the 'initialization_vector' field.</p>
      <p>Each protection systems' PSSH box is encapsulated in a separate elementary stream identified by a unique CETS PSSH PID. A 'CA_descriptor()' contains the CETS PSSH PID for each protection system in use. The 'CA_descriptor()' also contains the scheme type and version, and encryption algorithm in the 'scheme_type', 'scheme_version' and 'encryption_algorithm' fields, respectively.</p>
      <p>The 'CA_descriptor()' MUST appear in the inner loop of the PMT where it applies to a specific elementary stream.</p>
      <p class='note'>[[!CENC-MPEG2]] does not specify where in the PMT the CA_descriptor() may appear. A future amendment will restrict it to the inner loop.<p>
    </section>

    <section id="detect-encrypt">
      <h2>Detecting Encryption</h2>
      <p>Protection scheme signaling conforms with MPEG-2 Transport Stream [[!MPEG2TS]]. When 'cenc' protection has been applied, a 'CA_descriptor()' will be present in the program map table ('TS_program_map_section') and the 'CA_SystemID' field will contain the value 'ce'. The 'CA_descriptor()' identifies the 'CETS_ECM' elementary stream ('CA_PID' field), encryption algorithm ('encryption_algorithm' field), the PSSH elementary stream ('pssh_id' field) for each protection system used and a 'scheme_type' field set to a value of 'cenc' (Common Encryption).</p>
      <p>The "encrypted block" is an access unit 'AU'. A 'CETS ECM' defines 'num_states' encryption states. Each 'CETS_ECM' state defines how PES packets are encrypted for PES packets with a 'transport_scrambling_control' field that matches the 'CETS_ECM' state 'transport_scrambling_control' field.</p>
      <p>For complete information, see [[!CENC-MPEG2]].</p>
    </section>

    <section id="init-data">
      <h2>Initialization Data</h2>
      <p>MPEG-2 Transport Streams may contain one or more protection system specific header ('pssh') boxes carried in an elementary stream, each for a unique SystemID at each location where a 'pssh' box is necessary. </p>
      <p><a def-id="initialization-data"></a> MUST be created from 'pssh' boxes as defined in [[CENC-INIT]]. <a def-id="initialization-data"></a> MUST be created from 'pssh' boxes in all elementary streams referenced by the set of 'pssh_pid' fields in a 'CA_descriptor()'.</p>
    </section>
  </body>
</html>
